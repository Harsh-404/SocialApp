<!-- Back Navigation -->
<nav class="top-nav">
    <button class="back-btn" routerLink="/feed">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="19" y1="12" x2="5" y2="12" />
            <polyline points="12 19 5 12 12 5" />
        </svg>
        <span>Back to Feed</span>
    </button>
    <h1 class="page-title">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2" />
            <circle cx="9" cy="7" r="4" />
            <path d="M23 21v-2a4 4 0 0 0-3-3.87" />
            <path d="M16 3.13a4 4 0 0 1 0 7.75" />
        </svg>
        Friends
    </h1>
</nav>

<div class="friends-wrapper">
    <!-- Search Section -->
    <div class="search-section">
        <div class="search-bar">
            <svg class="search-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none"
                stroke="currentColor" stroke-width="2">
                <circle cx="11" cy="11" r="8" />
                <line x1="21" y1="21" x2="16.65" y2="16.65" />
            </svg>
            <input [(ngModel)]="searchQuery" (input)="onSearch()" placeholder="Search people by name or email...">
        </div>

        <!-- Search Results -->
        <div class="search-results" *ngIf="searchResults.length > 0">
            <div class="result-card" *ngFor="let user of searchResults">
                <div class="result-avatar">{{ (user.username || '?')[0] }}</div>
                <div class="result-info">
                    <span class="result-name">{{ user.username }}</span>
                    <span class="result-meta" *ngIf="user.first_name || user.last_name">{{ user.first_name }} {{
                        user.last_name }}</span>
                    <span class="result-meta" *ngIf="user.email">{{ user.email }}</span>
                </div>
                <button class="btn-view" (click)="viewProfile(user.id)">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                        stroke-width="2">
                        <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z" />
                        <circle cx="12" cy="12" r="3" />
                    </svg>
                    View
                </button>
            </div>
        </div>

        <div class="search-empty" *ngIf="searchQuery.length > 2 && searchResults.length === 0">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                stroke-width="1.5">
                <circle cx="11" cy="11" r="8" />
                <line x1="21" y1="21" x2="16.65" y2="16.65" />
                <line x1="8" y1="11" x2="14" y2="11" />
            </svg>
            <p>No users found matching "{{ searchQuery }}"</p>
        </div>
    </div>

    <!-- Profile Preview Card -->
    <div class="profile-preview" *ngIf="profile && user">
        <div class="preview-banner"></div>
        <div class="preview-content">
            <img [src]="getProfilePic()" alt="Profile Picture" class="preview-avatar">
            <h2 class="preview-name">{{ user.username }}</h2>

            <div class="preview-details">
                <div class="detail-item" *ngIf="profile.bio">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                        stroke-width="2">
                        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z" />
                        <polyline points="14 2 14 8 20 8" />
                        <line x1="16" y1="13" x2="8" y2="13" />
                        <line x1="16" y1="17" x2="8" y2="17" />
                    </svg>
                    <span>{{ profile.bio }}</span>
                </div>
                <div class="detail-item" *ngIf="profile.location">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                        stroke-width="2">
                        <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z" />
                        <circle cx="12" cy="10" r="3" />
                    </svg>
                    <span>{{ profile.location }}</span>
                </div>
                <div class="detail-item" *ngIf="profile.birth_date">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                        stroke-width="2">
                        <rect x="3" y="4" width="18" height="18" rx="2" ry="2" />
                        <line x1="16" y1="2" x2="16" y2="6" />
                        <line x1="8" y1="2" x2="8" y2="6" />
                        <line x1="3" y1="10" x2="21" y2="10" />
                    </svg>
                    <span>{{ profile.birth_date }}</span>
                </div>
            </div>

            <button *ngIf="isFriendAllowed" class="btn-add-friend" (click)="sendRequest(profile.id)">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                    stroke-width="2">
                    <path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2" />
                    <circle cx="8.5" cy="7" r="4" />
                    <line x1="20" y1="8" x2="20" y2="14" />
                    <line x1="23" y1="11" x2="17" y2="11" />
                </svg>
                Send Friend Request
            </button>
            <div class="already-friends-badge" *ngIf="!isFriendAllowed">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                    stroke-width="2">
                    <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14" />
                    <polyline points="22 4 12 14.01 9 11.01" />
                </svg>
                Already Friends
            </div>
        </div>
    </div>

    <!-- Two Column Layout for Requests & Friends -->
    <div class="columns-grid">
        <!-- Friend Requests Column -->
        <div class="section-card">
            <div class="section-title">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                    stroke-width="2">
                    <path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2" />
                    <circle cx="8.5" cy="7" r="4" />
                    <polyline points="17 11 19 13 23 9" />
                </svg>
                <h3>Incoming Requests</h3>
                <span class="badge" *ngIf="incomingRequests.length > 0">{{ incomingRequests.length }}</span>
            </div>

            <div class="request-list" *ngIf="incomingRequests.length > 0">
                <div class="request-item" *ngFor="let request of incomingRequests">
                    <div class="req-avatar">{{ (request.from_user || '?')[0] }}</div>
                    <span class="req-name">{{ request.from_user }}</span>
                    <div class="req-actions">
                        <button class="btn-accept" (click)="acceptRequest(request.id)" title="Accept">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none"
                                stroke="currentColor" stroke-width="2.5">
                                <polyline points="20 6 9 17 4 12" />
                            </svg>
                        </button>
                        <button class="btn-decline" (click)="declineRequest(request.id)" title="Decline">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none"
                                stroke="currentColor" stroke-width="2.5">
                                <line x1="18" y1="6" x2="6" y2="18" />
                                <line x1="6" y1="6" x2="18" y2="18" />
                            </svg>
                        </button>
                    </div>
                </div>
            </div>
            <div class="empty-section" *ngIf="incomingRequests.length === 0">
                <p>No incoming requests</p>
            </div>

            <!-- Outgoing -->
            <div class="section-title outgoing-title">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                    stroke-width="2">
                    <line x1="22" y1="2" x2="11" y2="13" />
                    <polygon points="22 2 15 22 11 13 2 9 22 2" />
                </svg>
                <h3>Sent Requests</h3>
                <span class="badge outgoing-badge" *ngIf="outgoingRequests.length > 0">{{ outgoingRequests.length
                    }}</span>
            </div>

            <div class="request-list" *ngIf="outgoingRequests.length > 0">
                <div class="request-item" *ngFor="let request of outgoingRequests">
                    <div class="req-avatar outgoing-avatar">{{ (request.to_user || '?')[0] }}</div>
                    <span class="req-name">{{ request.to_user }}</span>
                    <button class="btn-cancel-req" (click)="cancelRequest(request.id)">Cancel</button>
                </div>
            </div>
            <div class="empty-section" *ngIf="outgoingRequests.length === 0">
                <p>No sent requests</p>
            </div>
        </div>

        <!-- Friends List Column -->
        <div class="section-card">
            <div class="section-title">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                    stroke-width="2">
                    <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2" />
                    <circle cx="9" cy="7" r="4" />
                    <path d="M23 21v-2a4 4 0 0 0-3-3.87" />
                    <path d="M16 3.13a4 4 0 0 1 0 7.75" />
                </svg>
                <h3>My Friends</h3>
                <span class="badge friends-badge" *ngIf="listRequests.length > 0">{{ listRequests.length }}</span>
            </div>

            <div class="friends-grid" *ngIf="listRequests.length > 0">
                <div class="friend-card" *ngFor="let friend of listRequests">
                    <div class="friend-avatar">{{ (friend.username || '?')[0] }}</div>
                    <span class="friend-name">{{ friend.username }}</span>
                    <button class="btn-remove" (click)="removeFriend(friend.friend_id)" title="Remove friend">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2">
                            <path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2" />
                            <circle cx="8.5" cy="7" r="4" />
                            <line x1="23" y1="11" x2="17" y2="11" />
                        </svg>
                    </button>
                </div>
            </div>

            <div class="empty-section" *ngIf="listRequests.length === 0">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                    stroke-width="1.5">
                    <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2" />
                    <circle cx="9" cy="7" r="4" />
                    <path d="M23 21v-2a4 4 0 0 0-3-3.87" />
                    <path d="M16 3.13a4 4 0 0 1 0 7.75" />
                </svg>
                <p>No friends yet. Search for people above!</p>
            </div>
        </div>
    </div>
</div>